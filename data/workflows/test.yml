# This is a basic workflow to help you get started with Actions

name: Ciao

on:
  push:
    branches: [ "release" ]
    types: [ "released" ]
  pull_request:
    branches: [ "master" ]
    tags: [ "master", "release" ]

permissions:
  actions: read
  others: write
  tests: none

defaults:
  ciao: 1
  ciao1: ciao
  run:
    shell: ciao
    ciao: ciao
    bho:
      ciao: ciao

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

env:
  VAR: ${{ github.workflow }}
  VAR1: ciao
  VAR2: ciao-${{}}
  VAR3: ciao ${{github}}

# A workflow run is made up of one or more jobs that can run sequentially or in parallel
jobs:
  # This workflow contains a single job called "build"
  build:
    name: Build repo

    uses: octo-org/example-repo/.github/workflows/called-workflow.yml@main

    with:
      username: mona

    permissions: read-all

    needs:
      - ciao
      - ciao2

    if: "github.repository == 'octo-org/octo-repo-prod'"

    # The type of runner that the job will run on
    runs-on: ubuntu-latest

    environment:
      name: production_environment
      url: https://github.com

    env:
      CIAO: true
      CIAO1: 1

    concurrency:
      group: ${{ github.workflow }}-${{ github.ref }}
      cancel-in-progress: true

    container:
      image: node:18
      env:
        NODE_ENV: development
      ports:
        - 80
      volumes:
        - my_docker_volume:/volume_mount
      options: --cpus 1

    services:
      nginx:
        image: nginx
        # Map port 8080 on the Docker host to port 80 on the nginx container
        ports:
          - 8080:80
      redis:
        image: redis
        # Map random free TCP port on Docker host to port 6379 on redis container
        ports:
          - 6379/tcp

    secrets: inherit

    # Steps represent a sequence of tasks that will be executed as part of the job
    steps:
      # Checks-out your repository under $GITHUB_WORKSPACE, so your job can access it
      - uses: actions/cache@v2

      - name: Release with Changelog
        uses: actions/checkout@8e5e7e5ab8b370d6c329ec480221332ada57f0ab
        with:
          token: ${{ secrets.GITHUB_TOKEN }}

  release:
    permissions:
      read: read
      write: write
    env: inherit
